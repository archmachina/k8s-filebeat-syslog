---
filebeat.config:
  modules:
    path: ${path.config}/modules.d/*.yml
    reload.enabled: false

processors:
  - copy_fields:
      fields:
        - from: event.original
          to: message
      fail_on_error: false
      ignore_missing: true
  - copy_fields:
      fields:
        - from: message
          to: event.original
      fail_on_error: false
      ignore_missing: true
  - add_cloud_metadata: ~
  - add_docker_metadata: ~
  - script:
      when:
        has_fields: ["log.source.address"]
      lang: javascript
      id: source_address
      source: |
        function process(event) {
          var hostData = event.Get("log.source.address").split(":")[0];
          event.Put("host.ip", hostData);
        }
  - script:
      lang: javascript
      id: timestamp
      source: |
        function process(event) {
          event.Put("@timestamp", new Date())
        }

setup.template.enabled: false
setup.ilm.enabled: true
setup.ilm.rollover_alias: "filebeat-syslog-%{[agent.version]}"
setup.ilm.pattern: "{now/d}-000001"
setup.ilm.policy_name: "default-beats"
setup.ilm.check_exists: true
setup.ilm.overwrite: false

output.elasticsearch:
  enabled: true
  hosts: ["${ELASTIC_HOST}:${ELASTIC_PORT}"]
  username: "${ELASTIC_USERNAME}"
  password: "${ELASTIC_PASSWORD}"
  ssl.certificate_authorities:
    - "/usr/share/filebeat/certs/ca.crt"
  loadbalance: true
  # index: "filebeat-syslog-%{[agent.version]}-%{+yyyy.MM.dd}"
  protocol: https
  ssl.enabled: true

# output.logstash:
#   enabled: true
#   hosts: ["${LOGSTASH_HOST}:${LOGSTASH_PORT}"]
#   index: "filebeat-syslog"
  # ssl.enabled: true
  # ssl.certificate_authorities:
  #   - "/usr/share/filebeat/certs/ca.crt"


filebeat.inputs:
  - type: syslog
    protocol.udp:
      host: "0.0.0.0:9000"
    tags: ["filebeat_plain_syslog"]

  - type: syslog
    protocol.tcp:
      host: "0.0.0.0:9000"
    tags: ["filebeat_plain_syslog"]

filebeat.modules:
  - module: cisco
    asa:
      enabled: true
      var.input: syslog
      var.syslog_host: 0.0.0.0
      var.syslog_port: 9001
    ftd:
      enabled: true
      var.input: syslog
      var.syslog_host: 0.0.0.0
      var.syslog_port: 9003
    ios:
      enabled: true
      var.input: syslog
      var.syslog_host: 0.0.0.0
      var.syslog_port: 9002
    nexus:
      enabled: true
      var.input: udp
      var.syslog_host: 0.0.0.0
      var.syslog_port: 9506
  - module: f5
    bigipapm:
      enabled: true
      var.input: udp
      var.syslog_host: 0.0.0.0
      var.syslog_port: 9504
